document.addEventListener("alpine:init",()=>{Alpine.data("grapesjs",({state:s,statePath:l,readOnly:c,tools:i,minHeight:o,container:n})=>({instance:null,state:s,tools:i,init(){this.instance=grapesjs.init({height:o+"px",container:n||".filament-grapesjs .grapesjs-wrapper",showOffsets:!0,fromElement:!0,noticeOnUnload:!1,storageManager:!1,loadHtml:s,plugins:["grapesjs-tailwind","grapesjs-preset-webpage"],assetManager:{upload:"/grapesjs/media",autoAdd:!0,assets:[],uploadFile:e=>{let r=e.dataTransfer?e.dataTransfer.files:e.target.files,a=new FormData;for(let t=0;t<r.length;t++)a.append("files[]",r[t]);fetch("/grapesjs/media",{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:a}).then(t=>{if(!t.ok)throw new Error("Upload failed");return t.json()}).then(t=>{Array.isArray(t)?t.forEach(d=>{this.instance.AssetManager.add(d)}):this.instance.AssetManager.add([t])}).catch(t=>console.error("Error:",t))}}}),fetch("/grapesjs/media").then(e=>{if(!e.ok)throw new Error("Failed to fetch assets");return e.json()}).then(e=>{Array.isArray(e)&&this.instance.AssetManager.add(e)}).catch(e=>console.error("Error:",e)),this.instance.on("update",e=>{var r=this.instance.getHtml({cleanId:!0}),a=r.match(/<body\b[^>]*>([\s\S]*?)<\/body>/);this.state=a?a[1]:this.instance.getHtml()})}}))});
